<!DOCTYPE html>

<html lang="en">

<head>

	<meta charset="UTF-8">
	<title>Bubbles</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta charset="UTF-8">
	<title>Canvas</title>
	<link rel="icon" type="image/png" href="/favicon.png" />


	<style>
		canvas {
			position: absolute;
			z-index: 0;
		}
		
		body {
			margin: 0px;
		}
		
		.win {
			position: absolute;
			top: calc(50vh - 300px);
			left: calc(50vw - 300px);
			width: 600px;
			height: 600px;
			background-color: ghostwhite;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: row;
			border-radius: 5px;
			box-shadow: 5px 10px 50px gray;
			opacity: 0;
			transition: all 1s ease-in-out;
			flex-wrap: wrap;
			padding: 20px;
		}
		
		.win__show {
			opacity: 1 !important;
		}
		
		.win__button {
			background-color: dodgerblue;
			/* Green */
			border: none;
			color: white;
			padding: 15px 32px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			font-family: sans-serif;
		}
		
		.win__header {
			font-family: sans-serif;
		}
		
		.me {
		    width: 100px;
		    }
		.adrienne {
		    width: 100px;
		    }
		.wordart {
		    width: 400px;
		}
		
	</style>


</head>

<body translate="no">

	<canvas></canvas>




	<script>
		var canvas = document.querySelector("canvas");

		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;

		var c = canvas.getContext("2d");
		let maxRadius = 50;

		let mouse = {
			x: canvas.width / 2,
			y: canvas.height / 2
		};

		var handled;
		var popCount = 0;

		window.addEventListener("mousemove", function(event) {
			mouse.x = event.x;
			mouse.y = event.y;
		});

		window.addEventListener("touchmove", function(event) {
			mouse.x = event.touches[0].clientX;
			mouse.y = event.touches[0].clientY;
		});

		window.addEventListener("mousedown", function(event) {
			if (bubblePop(event)) {
				blowTons = window.setTimeout(function() {
					blowTonsInterval = window.setInterval(function() {
						bubblePop();
					}, 100)
				}, 500);
			} else {
				bubbleBlow();
				blowTons = window.setTimeout(function() {
					blowTonsInterval = window.setInterval(function() {
						bubbleBlow();
					}, 100)
				}, 500);
			}
		});

		window.addEventListener("mouseup", function(event) {
			try {
				clearTimeout(blowTons);
				clearInterval(blowTonsInterval);
			} catch (err) {
				console.log("error, probs cool tho")
			}
		});

		window.addEventListener("touchstart", function(event) {
			mouse.x = event.touches[0].clientX;
			mouse.y = event.touches[0].clientY;
		});

		window.addEventListener("resize", function(event) {
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;

		});

		function distance(x1, y1, x2, y2) {
			var xDist = x2 - x1;
			var yDist = y2 - y1;

			return Math.sqrt(Math.pow(xDist, 2) + Math.pow(yDist, 2));
		}

		function bubblePop(event) {
			let target;
			for (let i = circlesArray.length - 1; i >= 0; i--) {
				let tested = circlesArray[i];
				let clickDist = distance(tested.x, tested.y, mouse.x, mouse.y);
				if (clickDist < tested.radius) {
					circlesArray.splice(i, 1);
					console.log("pop!");
					let pop = new Audio('pop.mp3');
					pop.play();
					return true;
				}
			}


		}

		function bubbleBlow(event) {
			let radius = Math.random() * 80 + 20;
			let x = mouse.x;
			let y = mouse.y;
			let dx = (Math.random() - 0.5) * 4;
			let dy = (Math.random() - 0.5) * 4;
			circlesArray.push(new Circle(x, y, radius, dx, dy));

			let snap = new Audio('snap.mp3');
			snap.play();
		}

		function Circle(x, y, r, dx, dy) {
			this.x = x;
			this.y = y;
			this.dx = dx;
			this.dy = dy;
			this.radius = r;
			this.hue = Math.random() * 360;

			this.draw = function() {
				c.beginPath();
				c.strokeStyle = `hsl(${this.hue}, 100%, 20%)`;
				c.fillStyle = `hsl(${this.hue}, 100%, 50%)`;
				c.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
				c.stroke();
				c.fill();
			};

			this.update = function() {
				if (this.x + this.radius > innerWidth) {
					this.dx = -Math.abs(this.dx);
				}
				if (this.x - this.radius < 0) {
					this.dx = Math.abs(this.dx);
				}
				if (this.y + this.radius > innerHeight) {
					this.dy = -Math.abs(this.dy);
				}
				if (this.y - this.radius < 0) {
					this.dy = Math.abs(this.dy);
				}

				this.x += this.dx;
				this.y += this.dy;

				this.hue++;
				if (this.hue > 360) {
					this.hue = 0;
				}

				this.draw();
			};
		}


		let circlesArray = [];

		function init() {
			for (let i = 0; i < 20 /*(innerWidth + innerHeight) / 10 + 1*/; i++) {
				let radius = Math.random() * 80 + 20;
				let x = Math.random() * (innerWidth - 2 * radius) + radius;
				let y = Math.random() * (innerHeight - 2 * radius) + radius;
				let dx = (Math.random() - 0.5) * 4;
				let dy = (Math.random() - 0.5) * 4;
				circlesArray.push(new Circle(x, y, radius, dx, dy));
			}
		}

		function win() {

			for (let i = 0; i < (innerWidth + innerHeight) / 10; i++) {
				let randomQuad = Math.ceil(Math.random() * 4);
				let radius = Math.random() * 80 + 20;
				let x, y;
				switch (randomQuad) {
					case 1:
						x = Math.random() * (innerWidth - 2 * radius) + radius;
						y = -radius;
						break;
					case 2:
						x = innerWidth + radius;
						y = Math.random() * (innerHeight - 2 * radius) + radius;
						break;
					case 3:
						x = Math.random() * (innerWidth - 2 * radius) + radius;
						y = innerHeight + radius;
						break;
					case 4:
						x = -radius;
						y = Math.random() * (innerHeight - 2 * radius) + radius;
						break;
				}
				let dx = (Math.random() - 0.5) * 4;
				let dy = (Math.random() - 0.5) * 4;
				circlesArray.push(new Circle(x, y, radius, dx, dy));
				try {
					clearTimeout(blowTons);
					clearInterval(blowTonsInterval);
				} catch (err) {
					console.log("error, probs cool tho")
				}
			}
		}

		init();

		function animate() {
			requestAnimationFrame(animate);
			c.clearRect(0, 0, innerWidth, innerHeight);


			for (let i in circlesArray) {
				circlesArray[i].update();
			}

			if (circlesArray.length == 0) {
				document.getElementById('win').classList.add("win__show");
				document.getElementById("win__button").disabled = false;
				document.getElementById("win").style.zIndex = "1";
				document.querySelector("canvas").setAttribute("style", "background-color: red; transform: translateX(200000px);");
			} else {
				setTimeout(function() {
					document.getElementById('win').classList.remove("win__show");
					document.getElementById("win__button").disabled = true;
					document.getElementById("win").style.zIndex = "-1";
					document.querySelector("canvas").setAttribute("style", "display: block;");
				}, 100);
				
			}

		}

		animate();
	</script>


	<div class='win' id='win'>
	   <img src="me.png" class="me">
	   <img src="prom.png" class="wordart">
	   <img src="adriennecutout.png" class="adrienne">
		<button class="win__button" id='win__button' onClick="win();">Cool</button>
		<a href="https://www.youtube.com/embed/XdofmoYcJNE" style="margin-left: 10px">No way jose</a>
	</div>



</body>

</html>
